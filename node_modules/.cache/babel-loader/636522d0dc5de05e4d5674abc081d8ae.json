{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { ExtensionMessageTarget, NetworkType, availableTransports } from '../..';\nimport { windowRef } from '../../MockWindow';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { desktopList, extensionList, iOSList, webList } from './wallet-lists';\nconst defaultExtensions = ['ookjlbkiijinhpmnjffcofjonbfbgaoc', 'gpfndedineagiepkpinficbcbbgjoenn' // Beacon\n];\nexport var Platform;\n\n(function (Platform) {\n  Platform[Platform[\"DESKTOP\"] = 0] = \"DESKTOP\";\n  Platform[Platform[\"IOS\"] = 1] = \"IOS\";\n  Platform[Platform[\"ANDROID\"] = 2] = \"ANDROID\";\n})(Platform || (Platform = {}));\n\nexport var WalletType;\n\n(function (WalletType) {\n  WalletType[\"IOS\"] = \"ios\";\n  WalletType[\"ANDROID\"] = \"android\";\n  WalletType[\"EXTENSION\"] = \"extension\";\n  WalletType[\"DESKTOP\"] = \"desktop\";\n  WalletType[\"WEB\"] = \"web\";\n})(WalletType || (WalletType = {}));\n/**\n * @internalapi\n *\n */\n\n\nexport class Pairing {\n  static getPlatfrom() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return isAndroid(window) ? Platform.ANDROID : isIOS(window) ? Platform.IOS : Platform.DESKTOP;\n    });\n  }\n\n  static getPairingInfo(pairingPayload, statusUpdateHandler, platform) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const activePlatform = platform !== null && platform !== void 0 ? platform : yield Pairing.getPlatfrom();\n      const pairingCode = pairingPayload.p2pSyncCode;\n      const postmessageSyncCode = pairingPayload.postmessageSyncCode;\n      const preferredNetwork = pairingPayload.preferredNetwork;\n\n      switch (activePlatform) {\n        case Platform.DESKTOP:\n          return Pairing.getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, preferredNetwork);\n\n        case Platform.IOS:\n          return Pairing.getIOSPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n\n        case Platform.ANDROID:\n          return Pairing.getAndroidPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n\n        default:\n          throw new Error('platform unknown');\n      }\n    });\n  }\n\n  static getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, network) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const availableExtensions = yield availableTransports.availableExtensions;\n      const qrLink = getTzip10Link('tezos://', pairingCode);\n      availableExtensions.forEach(ext => {\n        const index = defaultExtensions.indexOf(ext.id);\n\n        if (index >= 0) {\n          defaultExtensions.splice(index, 1);\n        }\n      });\n      return {\n        walletLists: [{\n          title: 'Browser Extensions',\n          type: WalletType.EXTENSION,\n          wallets: [...availableExtensions.map(app => {\n            var _a, _b, _c, _d;\n\n            const ext = extensionList.find(extEl => extEl.id === app.id);\n            return {\n              name: (_a = app.name) !== null && _a !== void 0 ? _a : ext === null || ext === void 0 ? void 0 : ext.name,\n              logo: (_b = app.iconUrl) !== null && _b !== void 0 ? _b : ext === null || ext === void 0 ? void 0 : ext.logo,\n              shortName: (_c = app.shortName) !== null && _c !== void 0 ? _c : ext === null || ext === void 0 ? void 0 : ext.shortName,\n              color: (_d = app.color) !== null && _d !== void 0 ? _d : ext === null || ext === void 0 ? void 0 : ext.color,\n              enabled: true,\n\n              clickHandler() {\n                if (postmessageSyncCode) {\n                  const message = {\n                    target: ExtensionMessageTarget.EXTENSION,\n                    payload: postmessageSyncCode,\n                    targetId: app.id\n                  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n                  windowRef.postMessage(message, windowRef.location.origin);\n                }\n\n                statusUpdateHandler(WalletType.EXTENSION, this);\n              }\n\n            };\n          }), ...extensionList.filter(app => defaultExtensions.some(extId => extId === app.id)).map(app => ({\n            name: app.name,\n            shortName: app.shortName,\n            color: app.color,\n            logo: app.logo,\n            enabled: false,\n            clickHandler: () => {// Don't do anything\n            }\n          }))]\n        }, {\n          title: 'Desktop & Web Wallets',\n          type: WalletType.DESKTOP,\n          wallets: [...desktopList.map(app => ({\n            name: app.name,\n            shortName: app.shortName,\n            color: app.color,\n            logo: app.logo,\n            enabled: true,\n\n            clickHandler() {\n              const link = getTzip10Link(app.deepLink, pairingCode);\n              window.open(link, '_blank');\n              statusUpdateHandler(WalletType.DESKTOP, this);\n            }\n\n          })), ...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n        }],\n        buttons: [],\n        qrData: qrLink\n      };\n    });\n  }\n\n  static getIOSPairingAlert(pairingCode, statusUpdateHandler, network) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const qrLink = getTzip10Link('tezos://', pairingCode);\n      return {\n        walletLists: [{\n          title: 'Mobile Wallets',\n          type: WalletType.IOS,\n          wallets: iOSList.map(app => ({\n            name: app.name,\n            shortName: app.shortName,\n            color: app.color,\n            logo: app.logo,\n            enabled: true,\n\n            clickHandler() {\n              var _a;\n\n              const link = getTzip10Link((_a = app.deepLink) !== null && _a !== void 0 ? _a : app.universalLink, pairingCode); // iOS does not trigger deeplinks with `window.open(...)`. The only way is using a normal link. So we have to work around that.\n\n              const a = document.createElement('a');\n              a.setAttribute('href', link);\n              a.dispatchEvent(new MouseEvent('click', {\n                view: window,\n                bubbles: true,\n                cancelable: true\n              }));\n              statusUpdateHandler(WalletType.IOS, this);\n            }\n\n          }))\n        }, {\n          title: 'Web Wallets',\n          type: WalletType.WEB,\n          wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n        }],\n        buttons: [],\n        qrData: qrLink\n      };\n    });\n  }\n\n  static getAndroidPairingAlert(pairingCode, statusUpdateHandler, network) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const qrLink = getTzip10Link('tezos://', pairingCode);\n      return {\n        walletLists: [{\n          title: 'Web Wallets',\n          type: WalletType.WEB,\n          wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n        }],\n        buttons: [{\n          title: 'Mobile Wallets',\n          text: 'Connect Wallet',\n          clickHandler: () => {\n            window.open(qrLink, '_blank');\n            statusUpdateHandler(WalletType.ANDROID);\n          }\n        }],\n        qrData: qrLink\n      };\n    });\n  }\n\n  static getWebList(pairingCode, statusUpdateHandler, network) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return webList.map(app => ({\n        name: app.name,\n        shortName: app.shortName,\n        color: app.color,\n        logo: app.logo,\n        enabled: true,\n\n        clickHandler() {\n          var _a;\n\n          const link = getTzip10Link((_a = app.links[network]) !== null && _a !== void 0 ? _a : app.links[NetworkType.MAINNET], pairingCode);\n          window.open(link, '_blank');\n          statusUpdateHandler(WalletType.WEB, this);\n        }\n\n      }));\n    });\n  }\n\n}","map":{"version":3,"sources":["../../../../src/ui/alert/Pairing.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAA2B,sBAA3B,EAAmD,WAAnD,EAAgE,mBAAhE,QAA2F,OAA3F;AACA,SAAS,SAAT,QAA0B,kBAA1B;AACA,SAAS,aAAT,QAA8B,6BAA9B;AACA,SAAS,SAAT,EAAoB,KAApB,QAAiC,sBAAjC;AACA,SAAS,WAAT,EAAsB,aAAtB,EAAqC,OAArC,EAA8C,OAA9C,QAA6D,gBAA7D;AAEA,MAAM,iBAAiB,GAAG,CACxB,kCADwB,EAExB,kCAFwB,CAEW;AAFX,CAA1B;AAKA,OAAA,IAAY,QAAZ;;AAAA,CAAA,UAAY,QAAZ,EAAoB;AAClB,EAAA,QAAA,CAAA,QAAA,CAAA,SAAA,CAAA,GAAA,CAAA,CAAA,GAAA,SAAA;AACA,EAAA,QAAA,CAAA,QAAA,CAAA,KAAA,CAAA,GAAA,CAAA,CAAA,GAAA,KAAA;AACA,EAAA,QAAA,CAAA,QAAA,CAAA,SAAA,CAAA,GAAA,CAAA,CAAA,GAAA,SAAA;AACD,CAJD,EAAY,QAAQ,KAAR,QAAQ,GAAA,EAAA,CAApB;;AAMA,OAAA,IAAY,UAAZ;;AAAA,CAAA,UAAY,UAAZ,EAAsB;AACpB,EAAA,UAAA,CAAA,KAAA,CAAA,GAAA,KAAA;AACA,EAAA,UAAA,CAAA,SAAA,CAAA,GAAA,SAAA;AACA,EAAA,UAAA,CAAA,WAAA,CAAA,GAAA,WAAA;AACA,EAAA,UAAA,CAAA,SAAA,CAAA,GAAA,SAAA;AACA,EAAA,UAAA,CAAA,KAAA,CAAA,GAAA,KAAA;AACD,CAND,EAAY,UAAU,KAAV,UAAU,GAAA,EAAA,CAAtB;AAqEA;;;AAGG;;;AACH,OAAM,MAAO,OAAP,CAAc;AACa,SAAX,WAAW,GAAA;;AAC7B,aAAO,SAAS,CAAC,MAAD,CAAT,GAAoB,QAAQ,CAAC,OAA7B,GAAuC,KAAK,CAAC,MAAD,CAAL,GAAgB,QAAQ,CAAC,GAAzB,GAA+B,QAAQ,CAAC,OAAtF;AACD,K;AAAA;;AAEiC,SAAd,cAAc,CAChC,cADgC,EAMhC,mBANgC,EAOhC,QAPgC,EAOb;;AAEnB,YAAM,cAAc,GAAG,QAAQ,KAAA,IAAR,IAAA,QAAQ,KAAA,KAAA,CAAR,GAAA,QAAA,GAAa,MAAM,OAAO,CAAC,WAAR,EAA1C;AAEA,YAAM,WAAW,GAAG,cAAc,CAAC,WAAnC;AACA,YAAM,mBAAmB,GAAG,cAAc,CAAC,mBAA3C;AACA,YAAM,gBAAgB,GAAG,cAAc,CAAC,gBAAxC;;AAEA,cAAQ,cAAR;AACE,aAAK,QAAQ,CAAC,OAAd;AACE,iBAAO,OAAO,CAAC,sBAAR,CACL,WADK,EAEL,mBAFK,EAGL,mBAHK,EAIL,gBAJK,CAAP;;AAMF,aAAK,QAAQ,CAAC,GAAd;AACE,iBAAO,OAAO,CAAC,kBAAR,CAA2B,WAA3B,EAAwC,mBAAxC,EAA6D,gBAA7D,CAAP;;AACF,aAAK,QAAQ,CAAC,OAAd;AACE,iBAAO,OAAO,CAAC,sBAAR,CAA+B,WAA/B,EAA4C,mBAA5C,EAAiE,gBAAjE,CAAP;;AAEF;AACE,gBAAM,IAAI,KAAJ,CAAU,kBAAV,CAAN;AAdJ;AAgBD,K;AAAA;;AAE0C,SAAtB,sBAAsB,CACzC,WADyC,EAEzC,mBAFyC,EAGzC,mBAHyC,EAIzC,OAJyC,EAIrB;;AAEpB,YAAM,mBAAmB,GAAG,MAAM,mBAAmB,CAAC,mBAAtD;AACA,YAAM,MAAM,GAAG,aAAa,CAAC,UAAD,EAAa,WAAb,CAA5B;AAEA,MAAA,mBAAmB,CAAC,OAApB,CAA6B,GAAD,IAAQ;AAClC,cAAM,KAAK,GAAG,iBAAiB,CAAC,OAAlB,CAA0B,GAAG,CAAC,EAA9B,CAAd;;AACA,YAAI,KAAK,IAAI,CAAb,EAAgB;AACd,UAAA,iBAAiB,CAAC,MAAlB,CAAyB,KAAzB,EAAgC,CAAhC;AACD;AACF,OALD;AAOA,aAAO;AACL,QAAA,WAAW,EAAE,CACX;AACE,UAAA,KAAK,EAAE,oBADT;AAEE,UAAA,IAAI,EAAE,UAAU,CAAC,SAFnB;AAGE,UAAA,OAAO,EAAE,CACP,GAAG,mBAAmB,CAAC,GAApB,CAAyB,GAAD,IAAQ;;;AACjC,kBAAM,GAAG,GAAG,aAAa,CAAC,IAAd,CAAoB,KAAD,IAAW,KAAK,CAAC,EAAN,KAAa,GAAG,CAAC,EAA/C,CAAZ;AAEA,mBAAO;AACL,cAAA,IAAI,EAAA,CAAA,EAAA,GAAE,GAAG,CAAC,IAAN,MAAU,IAAV,IAAU,EAAA,KAAA,KAAA,CAAV,GAAU,EAAV,GAAc,GAAG,KAAA,IAAH,IAAA,GAAG,KAAA,KAAA,CAAH,GAAG,KAAA,CAAH,GAAA,GAAG,CAAE,IADlB;AAEL,cAAA,IAAI,EAAA,CAAA,EAAA,GAAE,GAAG,CAAC,OAAN,MAAa,IAAb,IAAa,EAAA,KAAA,KAAA,CAAb,GAAa,EAAb,GAAiB,GAAG,KAAA,IAAH,IAAA,GAAG,KAAA,KAAA,CAAH,GAAG,KAAA,CAAH,GAAA,GAAG,CAAE,IAFrB;AAGL,cAAA,SAAS,EAAA,CAAA,EAAA,GAAE,GAAG,CAAC,SAAN,MAAe,IAAf,IAAe,EAAA,KAAA,KAAA,CAAf,GAAe,EAAf,GAAmB,GAAG,KAAA,IAAH,IAAA,GAAG,KAAA,KAAA,CAAH,GAAG,KAAA,CAAH,GAAA,GAAG,CAAE,SAH5B;AAIL,cAAA,KAAK,EAAA,CAAA,EAAA,GAAE,GAAG,CAAC,KAAN,MAAW,IAAX,IAAW,EAAA,KAAA,KAAA,CAAX,GAAW,EAAX,GAAe,GAAG,KAAA,IAAH,IAAA,GAAG,KAAA,KAAA,CAAH,GAAG,KAAA,CAAH,GAAA,GAAG,CAAE,KAJpB;AAKL,cAAA,OAAO,EAAE,IALJ;;AAML,cAAA,YAAY,GAAA;AACV,oBAAI,mBAAJ,EAAyB;AACvB,wBAAM,OAAO,GAA6B;AACxC,oBAAA,MAAM,EAAE,sBAAsB,CAAC,SADS;AAExC,oBAAA,OAAO,EAAE,mBAF+B;AAGxC,oBAAA,QAAQ,EAAE,GAAG,CAAC;AAH0B,mBAA1C,CADuB,CAMvB;;AACA,kBAAA,SAAS,CAAC,WAAV,CAAsB,OAAtB,EAAsC,SAAS,CAAC,QAAV,CAAmB,MAAzD;AACD;;AACD,gBAAA,mBAAmB,CAAC,UAAU,CAAC,SAAZ,EAAuB,IAAvB,CAAnB;AACD;;AAjBI,aAAP;AAmBD,WAtBE,CADI,EAwBP,GAAG,aAAa,CACb,MADA,CACQ,GAAD,IAAS,iBAAiB,CAAC,IAAlB,CAAwB,KAAD,IAAW,KAAK,KAAK,GAAG,CAAC,EAAhD,CADhB,EAEA,GAFA,CAEK,GAAD,KAAU;AACb,YAAA,IAAI,EAAE,GAAG,CAAC,IADG;AAEb,YAAA,SAAS,EAAE,GAAG,CAAC,SAFF;AAGb,YAAA,KAAK,EAAE,GAAG,CAAC,KAHE;AAIb,YAAA,IAAI,EAAE,GAAG,CAAC,IAJG;AAKb,YAAA,OAAO,EAAE,KALI;AAMb,YAAA,YAAY,EAAE,MAAW,CACvB;AACD;AARY,WAAV,CAFJ,CAxBI;AAHX,SADW,EA0CX;AACE,UAAA,KAAK,EAAE,uBADT;AAEE,UAAA,IAAI,EAAE,UAAU,CAAC,OAFnB;AAGE,UAAA,OAAO,EAAE,CACP,GAAG,WAAW,CAAC,GAAZ,CAAiB,GAAD,KAAU;AAC3B,YAAA,IAAI,EAAE,GAAG,CAAC,IADiB;AAE3B,YAAA,SAAS,EAAE,GAAG,CAAC,SAFY;AAG3B,YAAA,KAAK,EAAE,GAAG,CAAC,KAHgB;AAI3B,YAAA,IAAI,EAAE,GAAG,CAAC,IAJiB;AAK3B,YAAA,OAAO,EAAE,IALkB;;AAM3B,YAAA,YAAY,GAAA;AACV,oBAAM,IAAI,GAAG,aAAa,CAAC,GAAG,CAAC,QAAL,EAAe,WAAf,CAA1B;AACA,cAAA,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB,QAAlB;AACA,cAAA,mBAAmB,CAAC,UAAU,CAAC,OAAZ,EAAqB,IAArB,CAAnB;AACD;;AAV0B,WAAV,CAAhB,CADI,EAaP,IAAI,MAAM,OAAO,CAAC,UAAR,CAAmB,WAAnB,EAAgC,mBAAhC,EAAqD,OAArD,CAAV,CAbO;AAHX,SA1CW,CADR;AA+DL,QAAA,OAAO,EAAE,EA/DJ;AAgEL,QAAA,MAAM,EAAE;AAhEH,OAAP;AAkED,K;AAAA;;AAEsC,SAAlB,kBAAkB,CACrC,WADqC,EAErC,mBAFqC,EAGrC,OAHqC,EAGjB;;AAEpB,YAAM,MAAM,GAAG,aAAa,CAAC,UAAD,EAAa,WAAb,CAA5B;AAEA,aAAO;AACL,QAAA,WAAW,EAAE,CACX;AACE,UAAA,KAAK,EAAE,gBADT;AAEE,UAAA,IAAI,EAAE,UAAU,CAAC,GAFnB;AAGE,UAAA,OAAO,EAAE,OAAO,CAAC,GAAR,CAAa,GAAD,KAAU;AAC7B,YAAA,IAAI,EAAE,GAAG,CAAC,IADmB;AAE7B,YAAA,SAAS,EAAE,GAAG,CAAC,SAFc;AAG7B,YAAA,KAAK,EAAE,GAAG,CAAC,KAHkB;AAI7B,YAAA,IAAI,EAAE,GAAG,CAAC,IAJmB;AAK7B,YAAA,OAAO,EAAE,IALoB;;AAM7B,YAAA,YAAY,GAAA;;;AACV,oBAAM,IAAI,GAAG,aAAa,CAAA,CAAA,EAAA,GAAC,GAAG,CAAC,QAAL,MAAa,IAAb,IAAa,EAAA,KAAA,KAAA,CAAb,GAAa,EAAb,GAAiB,GAAG,CAAC,aAArB,EAAoC,WAApC,CAA1B,CADU,CAGV;;AACA,oBAAM,CAAC,GAAG,QAAQ,CAAC,aAAT,CAAuB,GAAvB,CAAV;AACA,cAAA,CAAC,CAAC,YAAF,CAAe,MAAf,EAAuB,IAAvB;AACA,cAAA,CAAC,CAAC,aAAF,CACE,IAAI,UAAJ,CAAe,OAAf,EAAwB;AAAE,gBAAA,IAAI,EAAE,MAAR;AAAgB,gBAAA,OAAO,EAAE,IAAzB;AAA+B,gBAAA,UAAU,EAAE;AAA3C,eAAxB,CADF;AAIA,cAAA,mBAAmB,CAAC,UAAU,CAAC,GAAZ,EAAiB,IAAjB,CAAnB;AACD;;AAjB4B,WAAV,CAAZ;AAHX,SADW,EAwBX;AACE,UAAA,KAAK,EAAE,aADT;AAEE,UAAA,IAAI,EAAE,UAAU,CAAC,GAFnB;AAGE,UAAA,OAAO,EAAE,CAAC,IAAI,MAAM,OAAO,CAAC,UAAR,CAAmB,WAAnB,EAAgC,mBAAhC,EAAqD,OAArD,CAAV,CAAD;AAHX,SAxBW,CADR;AA+BL,QAAA,OAAO,EAAE,EA/BJ;AAgCL,QAAA,MAAM,EAAE;AAhCH,OAAP;AAkCD,K;AAAA;;AAE0C,SAAtB,sBAAsB,CACzC,WADyC,EAEzC,mBAFyC,EAGzC,OAHyC,EAGrB;;AAEpB,YAAM,MAAM,GAAG,aAAa,CAAC,UAAD,EAAa,WAAb,CAA5B;AAEA,aAAO;AACL,QAAA,WAAW,EAAE,CACX;AACE,UAAA,KAAK,EAAE,aADT;AAEE,UAAA,IAAI,EAAE,UAAU,CAAC,GAFnB;AAGE,UAAA,OAAO,EAAE,CAAC,IAAI,MAAM,OAAO,CAAC,UAAR,CAAmB,WAAnB,EAAgC,mBAAhC,EAAqD,OAArD,CAAV,CAAD;AAHX,SADW,CADR;AAQL,QAAA,OAAO,EAAE,CACP;AACE,UAAA,KAAK,EAAE,gBADT;AAEE,UAAA,IAAI,EAAE,gBAFR;AAGE,UAAA,YAAY,EAAE,MAAW;AACvB,YAAA,MAAM,CAAC,IAAP,CAAY,MAAZ,EAAoB,QAApB;AACA,YAAA,mBAAmB,CAAC,UAAU,CAAC,OAAZ,CAAnB;AACD;AANH,SADO,CARJ;AAkBL,QAAA,MAAM,EAAE;AAlBH,OAAP;AAoBD,K;AAAA;;AAE8B,SAAV,UAAU,CAC7B,WAD6B,EAE7B,mBAF6B,EAG7B,OAH6B,EAGT;;AAEpB,aAAO,OAAO,CAAC,GAAR,CAAa,GAAD,KAAU;AAC3B,QAAA,IAAI,EAAE,GAAG,CAAC,IADiB;AAE3B,QAAA,SAAS,EAAE,GAAG,CAAC,SAFY;AAG3B,QAAA,KAAK,EAAE,GAAG,CAAC,KAHgB;AAI3B,QAAA,IAAI,EAAE,GAAG,CAAC,IAJiB;AAK3B,QAAA,OAAO,EAAE,IALkB;;AAM3B,QAAA,YAAY,GAAA;;;AACV,gBAAM,IAAI,GAAG,aAAa,CAAA,CAAA,EAAA,GACxB,GAAG,CAAC,KAAJ,CAAU,OAAV,CADwB,MACN,IADM,IACN,EAAA,KAAA,KAAA,CADM,GACN,EADM,GACF,GAAG,CAAC,KAAJ,CAAU,WAAW,CAAC,OAAtB,CADE,EAExB,WAFwB,CAA1B;AAIA,UAAA,MAAM,CAAC,IAAP,CAAY,IAAZ,EAAkB,QAAlB;AACA,UAAA,mBAAmB,CAAC,UAAU,CAAC,GAAZ,EAAiB,IAAjB,CAAnB;AACD;;AAb0B,OAAV,CAAZ,CAAP;AAeD,K;AAAA;;AAtNiB","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ExtensionMessageTarget, NetworkType, availableTransports } from '../..';\nimport { windowRef } from '../../MockWindow';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { desktopList, extensionList, iOSList, webList } from './wallet-lists';\nconst defaultExtensions = [\n    'ookjlbkiijinhpmnjffcofjonbfbgaoc',\n    'gpfndedineagiepkpinficbcbbgjoenn' // Beacon\n];\nexport var Platform;\n(function (Platform) {\n    Platform[Platform[\"DESKTOP\"] = 0] = \"DESKTOP\";\n    Platform[Platform[\"IOS\"] = 1] = \"IOS\";\n    Platform[Platform[\"ANDROID\"] = 2] = \"ANDROID\";\n})(Platform || (Platform = {}));\nexport var WalletType;\n(function (WalletType) {\n    WalletType[\"IOS\"] = \"ios\";\n    WalletType[\"ANDROID\"] = \"android\";\n    WalletType[\"EXTENSION\"] = \"extension\";\n    WalletType[\"DESKTOP\"] = \"desktop\";\n    WalletType[\"WEB\"] = \"web\";\n})(WalletType || (WalletType = {}));\n/**\n * @internalapi\n *\n */\nexport class Pairing {\n    static getPlatfrom() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return isAndroid(window) ? Platform.ANDROID : isIOS(window) ? Platform.IOS : Platform.DESKTOP;\n        });\n    }\n    static getPairingInfo(pairingPayload, statusUpdateHandler, platform) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const activePlatform = platform !== null && platform !== void 0 ? platform : (yield Pairing.getPlatfrom());\n            const pairingCode = pairingPayload.p2pSyncCode;\n            const postmessageSyncCode = pairingPayload.postmessageSyncCode;\n            const preferredNetwork = pairingPayload.preferredNetwork;\n            switch (activePlatform) {\n                case Platform.DESKTOP:\n                    return Pairing.getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, preferredNetwork);\n                case Platform.IOS:\n                    return Pairing.getIOSPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n                case Platform.ANDROID:\n                    return Pairing.getAndroidPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n                default:\n                    throw new Error('platform unknown');\n            }\n        });\n    }\n    static getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const availableExtensions = yield availableTransports.availableExtensions;\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            availableExtensions.forEach((ext) => {\n                const index = defaultExtensions.indexOf(ext.id);\n                if (index >= 0) {\n                    defaultExtensions.splice(index, 1);\n                }\n            });\n            return {\n                walletLists: [\n                    {\n                        title: 'Browser Extensions',\n                        type: WalletType.EXTENSION,\n                        wallets: [\n                            ...availableExtensions.map((app) => {\n                                var _a, _b, _c, _d;\n                                const ext = extensionList.find((extEl) => extEl.id === app.id);\n                                return {\n                                    name: (_a = app.name) !== null && _a !== void 0 ? _a : ext === null || ext === void 0 ? void 0 : ext.name,\n                                    logo: (_b = app.iconUrl) !== null && _b !== void 0 ? _b : ext === null || ext === void 0 ? void 0 : ext.logo,\n                                    shortName: (_c = app.shortName) !== null && _c !== void 0 ? _c : ext === null || ext === void 0 ? void 0 : ext.shortName,\n                                    color: (_d = app.color) !== null && _d !== void 0 ? _d : ext === null || ext === void 0 ? void 0 : ext.color,\n                                    enabled: true,\n                                    clickHandler() {\n                                        if (postmessageSyncCode) {\n                                            const message = {\n                                                target: ExtensionMessageTarget.EXTENSION,\n                                                payload: postmessageSyncCode,\n                                                targetId: app.id\n                                            };\n                                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                                            windowRef.postMessage(message, windowRef.location.origin);\n                                        }\n                                        statusUpdateHandler(WalletType.EXTENSION, this);\n                                    }\n                                };\n                            }),\n                            ...extensionList\n                                .filter((app) => defaultExtensions.some((extId) => extId === app.id))\n                                .map((app) => ({\n                                name: app.name,\n                                shortName: app.shortName,\n                                color: app.color,\n                                logo: app.logo,\n                                enabled: false,\n                                clickHandler: () => {\n                                    // Don't do anything\n                                }\n                            }))\n                        ]\n                    },\n                    {\n                        title: 'Desktop & Web Wallets',\n                        type: WalletType.DESKTOP,\n                        wallets: [\n                            ...desktopList.map((app) => ({\n                                name: app.name,\n                                shortName: app.shortName,\n                                color: app.color,\n                                logo: app.logo,\n                                enabled: true,\n                                clickHandler() {\n                                    const link = getTzip10Link(app.deepLink, pairingCode);\n                                    window.open(link, '_blank');\n                                    statusUpdateHandler(WalletType.DESKTOP, this);\n                                }\n                            })),\n                            ...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))\n                        ]\n                    }\n                ],\n                buttons: [],\n                qrData: qrLink\n            };\n        });\n    }\n    static getIOSPairingAlert(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            return {\n                walletLists: [\n                    {\n                        title: 'Mobile Wallets',\n                        type: WalletType.IOS,\n                        wallets: iOSList.map((app) => ({\n                            name: app.name,\n                            shortName: app.shortName,\n                            color: app.color,\n                            logo: app.logo,\n                            enabled: true,\n                            clickHandler() {\n                                var _a;\n                                const link = getTzip10Link((_a = app.deepLink) !== null && _a !== void 0 ? _a : app.universalLink, pairingCode);\n                                // iOS does not trigger deeplinks with `window.open(...)`. The only way is using a normal link. So we have to work around that.\n                                const a = document.createElement('a');\n                                a.setAttribute('href', link);\n                                a.dispatchEvent(new MouseEvent('click', { view: window, bubbles: true, cancelable: true }));\n                                statusUpdateHandler(WalletType.IOS, this);\n                            }\n                        }))\n                    },\n                    {\n                        title: 'Web Wallets',\n                        type: WalletType.WEB,\n                        wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n                    }\n                ],\n                buttons: [],\n                qrData: qrLink\n            };\n        });\n    }\n    static getAndroidPairingAlert(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            return {\n                walletLists: [\n                    {\n                        title: 'Web Wallets',\n                        type: WalletType.WEB,\n                        wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n                    }\n                ],\n                buttons: [\n                    {\n                        title: 'Mobile Wallets',\n                        text: 'Connect Wallet',\n                        clickHandler: () => {\n                            window.open(qrLink, '_blank');\n                            statusUpdateHandler(WalletType.ANDROID);\n                        }\n                    }\n                ],\n                qrData: qrLink\n            };\n        });\n    }\n    static getWebList(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return webList.map((app) => ({\n                name: app.name,\n                shortName: app.shortName,\n                color: app.color,\n                logo: app.logo,\n                enabled: true,\n                clickHandler() {\n                    var _a;\n                    const link = getTzip10Link((_a = app.links[network]) !== null && _a !== void 0 ? _a : app.links[NetworkType.MAINNET], pairingCode);\n                    window.open(link, '_blank');\n                    statusUpdateHandler(WalletType.WEB, this);\n                }\n            }));\n        });\n    }\n}\n//# sourceMappingURL=Pairing.js.map"]},"metadata":{},"sourceType":"module"}