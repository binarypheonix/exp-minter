{"ast":null,"code":"import _regeneratorRuntime from\"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Flex,Image}from'@chakra-ui/react';import{FiHelpCircle}from'react-icons/fi';import{ipfsUriToGatewayUrl}from'../../lib/util/ipfs';function MediaNotFound(){return/*#__PURE__*/React.createElement(Flex,{flexDir:\"column\",align:\"center\",justify:\"center\",flex:\"1\",bg:\"gray.100\",color:\"gray.300\",height:\"100%\"},/*#__PURE__*/React.createElement(FiHelpCircle,{size:\"70px\"}));}export function TokenMedia(props){var _props$metadata$forma;var src=ipfsUriToGatewayUrl(props.config,props.artifactUri);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),errored=_useState2[0],setErrored=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),obj=_useState4[0],setObj=_useState4[1];useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var blob;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(src).then(function(r){return r.blob();});case 3:blob=_context.sent;_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",setErrored(true));case 9:setObj({url:URL.createObjectURL(blob),type:blob.type});case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}))();},[src]);if(errored){return/*#__PURE__*/React.createElement(MediaNotFound,null);}if(!obj)return null;if(/^image\\/.*/.test(obj.type)){var _props$objectFit,_props$maxH;return/*#__PURE__*/React.createElement(Image,{src:src,flex:\"1\",maxWidth:props.maxW,maxHeight:props.maxH,style:{objectFit:(_props$objectFit=props.objectFit)!==null&&_props$objectFit!==void 0?_props$objectFit:'cover',maxWidth:props.maxW,maxHeight:(_props$maxH=props.maxH)!==null&&_props$maxH!==void 0?_props$maxH:'50vh',cursor:props.cursor},onClick:props.onClick,onError:function onError(){return setErrored(true);}});}if(/^video\\/.*/.test(obj.type)){var _props$objectFit2,_props$maxH2;return/*#__PURE__*/React.createElement(\"video\",{preload:\"metadata\",onClick:function onClick(e){return e.preventDefault();},onMouseEnter:function onMouseEnter(e){return e.currentTarget.play();},onMouseLeave:function onMouseLeave(e){return e.currentTarget.pause();},style:{objectFit:(_props$objectFit2=props.objectFit)!==null&&_props$objectFit2!==void 0?_props$objectFit2:'cover',maxWidth:props.maxW,maxHeight:(_props$maxH2=props.maxH)!==null&&_props$maxH2!==void 0?_props$maxH2:'50vh',cursor:props.cursor},onLoadedMetadata:function onLoadedMetadata(e){e.target.currentTime=.05;},muted:true,controls:true},/*#__PURE__*/React.createElement(\"source\",{src:obj.url,type:obj.type}));}if((_props$metadata$forma=props.metadata.formats)===null||_props$metadata$forma===void 0?void 0:_props$metadata$forma.length){if(props.metadata.formats[0].mimeType==='model/gltf-binary'||props.metadata.formats[0].mimeType==='model/gltf+json'){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"model-viewer\",{\"auto-rotate\":true,\"rotation-per-second\":\"30deg\",\"camera-controls\":true,src:obj.url,class:props.class}));}}return/*#__PURE__*/React.createElement(MediaNotFound,null);}","map":{"version":3,"sources":["/Users/frankenstein/projects/minter/src/components/common/TokenMedia.tsx"],"names":["React","useEffect","useState","Flex","Image","FiHelpCircle","ipfsUriToGatewayUrl","MediaNotFound","TokenMedia","props","src","config","artifactUri","errored","setErrored","obj","setObj","fetch","then","r","blob","url","URL","createObjectURL","type","test","maxW","maxH","objectFit","maxWidth","maxHeight","cursor","onClick","e","preventDefault","currentTarget","play","pause","target","currentTime","metadata","formats","length","mimeType","class"],"mappings":"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","sourcesContent":["import React, { MouseEventHandler, useEffect, useState } from 'react';\nimport { Flex, Image } from '@chakra-ui/react';\nimport { FiHelpCircle } from 'react-icons/fi';\nimport { IpfsGatewayConfig, ipfsUriToGatewayUrl } from '../../lib/util/ipfs';\nimport { Token } from '../../reducer/slices/collections';\n\ninterface TokenMediaProps extends Token {\n  config: IpfsGatewayConfig;\n  maxW?: string;\n  maxH?: string;\n  class?: string;\n  cursor?: string;\n  objectFit?: any; //ObjectFitProperty | undefined; Todo ObjectFitProperty not found\n  onClick?: Function;\n}\n\nfunction MediaNotFound() {\n  return (\n    <Flex\n      flexDir=\"column\"\n      align=\"center\"\n      justify=\"center\"\n      flex=\"1\"\n      bg=\"gray.100\"\n      color=\"gray.300\"\n      height=\"100%\"\n    >\n      <FiHelpCircle size=\"70px\" />\n    </Flex>\n  );\n}\n\nexport function TokenMedia(props: TokenMediaProps) {\n  const src = ipfsUriToGatewayUrl(props.config, props.artifactUri);\n  const [errored, setErrored] = useState(false);\n  const [obj, setObj] = useState<{ url: string; type: string } | null>(null);\n  useEffect(() => {\n    (async () => {\n      let blob;\n      try {\n        blob = await fetch(src).then(r => r.blob());\n      } catch (e) {\n        return setErrored(true);\n      }\n      setObj({\n        url: URL.createObjectURL(blob),\n        type: blob.type\n      });\n    })();\n  }, [src]);\n\n  if (errored) {\n    return <MediaNotFound />;\n  }\n\n  if (!obj) return null;\n\n  if (/^image\\/.*/.test(obj.type)) {\n    return (\n      <Image\n        src={src}\n        flex=\"1\"\n        maxWidth={props.maxW}\n        maxHeight={props.maxH}\n        style={{ objectFit: props.objectFit ?? 'cover', maxWidth: props.maxW, maxHeight: props.maxH ?? '50vh', cursor: props.cursor }}\n        onClick={props.onClick as MouseEventHandler<HTMLImageElement>}\n        onError={() => setErrored(true)}\n      />\n    );\n  }\n\n  if (/^video\\/.*/.test(obj.type)) {\n    return (\n      <video\n      preload=\"metadata\"\n        onClick={e => e.preventDefault()}\n        onMouseEnter={e => e.currentTarget.play()}\n        onMouseLeave={e => e.currentTarget.pause()}\n        style={{ objectFit: props.objectFit ?? 'cover', maxWidth: props.maxW, maxHeight: props.maxH ?? '50vh', cursor: props.cursor }}\n        onLoadedMetadata={e => {(e.target as HTMLVideoElement).currentTime = .05; }}\n        muted\n        controls\n      >\n        <source src={obj.url} type={obj.type} />\n      </video>\n    );\n  }\n\n  if (props.metadata.formats?.length) {\n    if (\n      props.metadata.formats[0].mimeType === 'model/gltf-binary' ||\n      props.metadata.formats[0].mimeType === 'model/gltf+json'\n    ) {\n      return (\n        <>\n          <model-viewer\n            auto-rotate\n            rotation-per-second=\"30deg\"\n            camera-controls\n            src={obj.url}\n            class={props.class}\n          ></model-viewer>\n        </>\n      );\n    }\n  }\n\n  return <MediaNotFound />;\n}\n"]},"metadata":{},"sourceType":"module"}