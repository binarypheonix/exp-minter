{"ast":null,"code":"import _toConsumableArray from \"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/frankenstein/projects/minter/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { ExtensionMessageTarget, NetworkType, availableTransports } from '../..';\nimport { windowRef } from '../../MockWindow';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { desktopList, extensionList, iOSList, webList } from './wallet-lists';\nvar defaultExtensions = ['ookjlbkiijinhpmnjffcofjonbfbgaoc', 'gpfndedineagiepkpinficbcbbgjoenn' // Beacon\n];\nexport var Platform;\n\n(function (Platform) {\n  Platform[Platform[\"DESKTOP\"] = 0] = \"DESKTOP\";\n  Platform[Platform[\"IOS\"] = 1] = \"IOS\";\n  Platform[Platform[\"ANDROID\"] = 2] = \"ANDROID\";\n})(Platform || (Platform = {}));\n\nexport var WalletType;\n\n(function (WalletType) {\n  WalletType[\"IOS\"] = \"ios\";\n  WalletType[\"ANDROID\"] = \"android\";\n  WalletType[\"EXTENSION\"] = \"extension\";\n  WalletType[\"DESKTOP\"] = \"desktop\";\n  WalletType[\"WEB\"] = \"web\";\n})(WalletType || (WalletType = {}));\n/**\n * @internalapi\n *\n */\n\n\nexport var Pairing = /*#__PURE__*/function () {\n  function Pairing() {\n    _classCallCheck(this, Pairing);\n  }\n\n  _createClass(Pairing, null, [{\n    key: \"getPlatfrom\",\n    value: function getPlatfrom() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", isAndroid(window) ? Platform.ANDROID : isIOS(window) ? Platform.IOS : Platform.DESKTOP);\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n    }\n  }, {\n    key: \"getPairingInfo\",\n    value: function getPairingInfo(pairingPayload, statusUpdateHandler, platform) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var activePlatform, pairingCode, postmessageSyncCode, preferredNetwork;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(platform !== null && platform !== void 0)) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                _context2.t0 = platform;\n                _context2.next = 7;\n                break;\n\n              case 4:\n                _context2.next = 6;\n                return Pairing.getPlatfrom();\n\n              case 6:\n                _context2.t0 = _context2.sent;\n\n              case 7:\n                activePlatform = _context2.t0;\n                pairingCode = pairingPayload.p2pSyncCode;\n                postmessageSyncCode = pairingPayload.postmessageSyncCode;\n                preferredNetwork = pairingPayload.preferredNetwork;\n                _context2.t1 = activePlatform;\n                _context2.next = _context2.t1 === Platform.DESKTOP ? 14 : _context2.t1 === Platform.IOS ? 15 : _context2.t1 === Platform.ANDROID ? 16 : 17;\n                break;\n\n              case 14:\n                return _context2.abrupt(\"return\", Pairing.getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, preferredNetwork));\n\n              case 15:\n                return _context2.abrupt(\"return\", Pairing.getIOSPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork));\n\n              case 16:\n                return _context2.abrupt(\"return\", Pairing.getAndroidPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork));\n\n              case 17:\n                throw new Error('platform unknown');\n\n              case 18:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n    }\n  }, {\n    key: \"getDesktopPairingAlert\",\n    value: function getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, network) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var availableExtensions, qrLink;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return availableTransports.availableExtensions;\n\n              case 2:\n                availableExtensions = _context3.sent;\n                qrLink = getTzip10Link('tezos://', pairingCode);\n                availableExtensions.forEach(function (ext) {\n                  var index = defaultExtensions.indexOf(ext.id);\n\n                  if (index >= 0) {\n                    defaultExtensions.splice(index, 1);\n                  }\n                });\n                _context3.t0 = {\n                  title: 'Browser Extensions',\n                  type: WalletType.EXTENSION,\n                  wallets: [].concat(_toConsumableArray(availableExtensions.map(function (app) {\n                    var _a, _b, _c, _d;\n\n                    var ext = extensionList.find(function (extEl) {\n                      return extEl.id === app.id;\n                    });\n                    return {\n                      name: (_a = app.name) !== null && _a !== void 0 ? _a : ext === null || ext === void 0 ? void 0 : ext.name,\n                      logo: (_b = app.iconUrl) !== null && _b !== void 0 ? _b : ext === null || ext === void 0 ? void 0 : ext.logo,\n                      shortName: (_c = app.shortName) !== null && _c !== void 0 ? _c : ext === null || ext === void 0 ? void 0 : ext.shortName,\n                      color: (_d = app.color) !== null && _d !== void 0 ? _d : ext === null || ext === void 0 ? void 0 : ext.color,\n                      enabled: true,\n                      clickHandler: function clickHandler() {\n                        if (postmessageSyncCode) {\n                          var message = {\n                            target: ExtensionMessageTarget.EXTENSION,\n                            payload: postmessageSyncCode,\n                            targetId: app.id\n                          }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n                          windowRef.postMessage(message, windowRef.location.origin);\n                        }\n\n                        statusUpdateHandler(WalletType.EXTENSION, this);\n                      }\n                    };\n                  })), _toConsumableArray(extensionList.filter(function (app) {\n                    return defaultExtensions.some(function (extId) {\n                      return extId === app.id;\n                    });\n                  }).map(function (app) {\n                    return {\n                      name: app.name,\n                      shortName: app.shortName,\n                      color: app.color,\n                      logo: app.logo,\n                      enabled: false,\n                      clickHandler: function clickHandler() {// Don't do anything\n                      }\n                    };\n                  })))\n                };\n                _context3.t1 = WalletType.DESKTOP;\n                _context3.t2 = [];\n                _context3.t3 = _toConsumableArray(desktopList.map(function (app) {\n                  return {\n                    name: app.name,\n                    shortName: app.shortName,\n                    color: app.color,\n                    logo: app.logo,\n                    enabled: true,\n                    clickHandler: function clickHandler() {\n                      var link = getTzip10Link(app.deepLink, pairingCode);\n                      window.open(link, '_blank');\n                      statusUpdateHandler(WalletType.DESKTOP, this);\n                    }\n                  };\n                }));\n                _context3.t4 = _toConsumableArray;\n                _context3.next = 12;\n                return Pairing.getWebList(pairingCode, statusUpdateHandler, network);\n\n              case 12:\n                _context3.t5 = _context3.sent;\n                _context3.t6 = (0, _context3.t4)(_context3.t5);\n                _context3.t7 = _context3.t2.concat.call(_context3.t2, _context3.t3, _context3.t6);\n                _context3.t8 = {\n                  title: 'Desktop & Web Wallets',\n                  type: _context3.t1,\n                  wallets: _context3.t7\n                };\n                _context3.t9 = [_context3.t0, _context3.t8];\n                _context3.t10 = [];\n                _context3.t11 = qrLink;\n                return _context3.abrupt(\"return\", {\n                  walletLists: _context3.t9,\n                  buttons: _context3.t10,\n                  qrData: _context3.t11\n                });\n\n              case 20:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n    }\n  }, {\n    key: \"getIOSPairingAlert\",\n    value: function getIOSPairingAlert(pairingCode, statusUpdateHandler, network) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var qrLink;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                qrLink = getTzip10Link('tezos://', pairingCode);\n                _context4.t0 = {\n                  title: 'Mobile Wallets',\n                  type: WalletType.IOS,\n                  wallets: iOSList.map(function (app) {\n                    return {\n                      name: app.name,\n                      shortName: app.shortName,\n                      color: app.color,\n                      logo: app.logo,\n                      enabled: true,\n                      clickHandler: function clickHandler() {\n                        var _a;\n\n                        var link = getTzip10Link((_a = app.deepLink) !== null && _a !== void 0 ? _a : app.universalLink, pairingCode); // iOS does not trigger deeplinks with `window.open(...)`. The only way is using a normal link. So we have to work around that.\n\n                        var a = document.createElement('a');\n                        a.setAttribute('href', link);\n                        a.dispatchEvent(new MouseEvent('click', {\n                          view: window,\n                          bubbles: true,\n                          cancelable: true\n                        }));\n                        statusUpdateHandler(WalletType.IOS, this);\n                      }\n                    };\n                  })\n                };\n                _context4.t1 = WalletType.WEB;\n                _context4.t2 = _toConsumableArray;\n                _context4.next = 6;\n                return Pairing.getWebList(pairingCode, statusUpdateHandler, network);\n\n              case 6:\n                _context4.t3 = _context4.sent;\n                _context4.t4 = (0, _context4.t2)(_context4.t3);\n                _context4.t5 = {\n                  title: 'Web Wallets',\n                  type: _context4.t1,\n                  wallets: _context4.t4\n                };\n                _context4.t6 = [_context4.t0, _context4.t5];\n                _context4.t7 = [];\n                _context4.t8 = qrLink;\n                return _context4.abrupt(\"return\", {\n                  walletLists: _context4.t6,\n                  buttons: _context4.t7,\n                  qrData: _context4.t8\n                });\n\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n    }\n  }, {\n    key: \"getAndroidPairingAlert\",\n    value: function getAndroidPairingAlert(pairingCode, statusUpdateHandler, network) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var qrLink;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                qrLink = getTzip10Link('tezos://', pairingCode);\n                _context5.t0 = WalletType.WEB;\n                _context5.t1 = _toConsumableArray;\n                _context5.next = 5;\n                return Pairing.getWebList(pairingCode, statusUpdateHandler, network);\n\n              case 5:\n                _context5.t2 = _context5.sent;\n                _context5.t3 = (0, _context5.t1)(_context5.t2);\n                _context5.t4 = {\n                  title: 'Web Wallets',\n                  type: _context5.t0,\n                  wallets: _context5.t3\n                };\n                _context5.t5 = [_context5.t4];\n                _context5.t6 = [{\n                  title: 'Mobile Wallets',\n                  text: 'Connect Wallet',\n                  clickHandler: function clickHandler() {\n                    window.open(qrLink, '_blank');\n                    statusUpdateHandler(WalletType.ANDROID);\n                  }\n                }];\n                _context5.t7 = qrLink;\n                return _context5.abrupt(\"return\", {\n                  walletLists: _context5.t5,\n                  buttons: _context5.t6,\n                  qrData: _context5.t7\n                });\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n    }\n  }, {\n    key: \"getWebList\",\n    value: function getWebList(pairingCode, statusUpdateHandler, network) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                return _context6.abrupt(\"return\", webList.map(function (app) {\n                  return {\n                    name: app.name,\n                    shortName: app.shortName,\n                    color: app.color,\n                    logo: app.logo,\n                    enabled: true,\n                    clickHandler: function clickHandler() {\n                      var _a;\n\n                      var link = getTzip10Link((_a = app.links[network]) !== null && _a !== void 0 ? _a : app.links[NetworkType.MAINNET], pairingCode);\n                      window.open(link, '_blank');\n                      statusUpdateHandler(WalletType.WEB, this);\n                    }\n                  };\n                }));\n\n              case 1:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n    }\n  }]);\n\n  return Pairing;\n}();","map":{"version":3,"sources":["../../../../src/ui/alert/Pairing.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ExtensionMessageTarget, NetworkType, availableTransports } from '../..';\nimport { windowRef } from '../../MockWindow';\nimport { getTzip10Link } from '../../utils/get-tzip10-link';\nimport { isAndroid, isIOS } from '../../utils/platform';\nimport { desktopList, extensionList, iOSList, webList } from './wallet-lists';\nconst defaultExtensions = [\n    'ookjlbkiijinhpmnjffcofjonbfbgaoc',\n    'gpfndedineagiepkpinficbcbbgjoenn' // Beacon\n];\nexport var Platform;\n(function (Platform) {\n    Platform[Platform[\"DESKTOP\"] = 0] = \"DESKTOP\";\n    Platform[Platform[\"IOS\"] = 1] = \"IOS\";\n    Platform[Platform[\"ANDROID\"] = 2] = \"ANDROID\";\n})(Platform || (Platform = {}));\nexport var WalletType;\n(function (WalletType) {\n    WalletType[\"IOS\"] = \"ios\";\n    WalletType[\"ANDROID\"] = \"android\";\n    WalletType[\"EXTENSION\"] = \"extension\";\n    WalletType[\"DESKTOP\"] = \"desktop\";\n    WalletType[\"WEB\"] = \"web\";\n})(WalletType || (WalletType = {}));\n/**\n * @internalapi\n *\n */\nexport class Pairing {\n    static getPlatfrom() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return isAndroid(window) ? Platform.ANDROID : isIOS(window) ? Platform.IOS : Platform.DESKTOP;\n        });\n    }\n    static getPairingInfo(pairingPayload, statusUpdateHandler, platform) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const activePlatform = platform !== null && platform !== void 0 ? platform : (yield Pairing.getPlatfrom());\n            const pairingCode = pairingPayload.p2pSyncCode;\n            const postmessageSyncCode = pairingPayload.postmessageSyncCode;\n            const preferredNetwork = pairingPayload.preferredNetwork;\n            switch (activePlatform) {\n                case Platform.DESKTOP:\n                    return Pairing.getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, preferredNetwork);\n                case Platform.IOS:\n                    return Pairing.getIOSPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n                case Platform.ANDROID:\n                    return Pairing.getAndroidPairingAlert(pairingCode, statusUpdateHandler, preferredNetwork);\n                default:\n                    throw new Error('platform unknown');\n            }\n        });\n    }\n    static getDesktopPairingAlert(pairingCode, statusUpdateHandler, postmessageSyncCode, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const availableExtensions = yield availableTransports.availableExtensions;\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            availableExtensions.forEach((ext) => {\n                const index = defaultExtensions.indexOf(ext.id);\n                if (index >= 0) {\n                    defaultExtensions.splice(index, 1);\n                }\n            });\n            return {\n                walletLists: [\n                    {\n                        title: 'Browser Extensions',\n                        type: WalletType.EXTENSION,\n                        wallets: [\n                            ...availableExtensions.map((app) => {\n                                var _a, _b, _c, _d;\n                                const ext = extensionList.find((extEl) => extEl.id === app.id);\n                                return {\n                                    name: (_a = app.name) !== null && _a !== void 0 ? _a : ext === null || ext === void 0 ? void 0 : ext.name,\n                                    logo: (_b = app.iconUrl) !== null && _b !== void 0 ? _b : ext === null || ext === void 0 ? void 0 : ext.logo,\n                                    shortName: (_c = app.shortName) !== null && _c !== void 0 ? _c : ext === null || ext === void 0 ? void 0 : ext.shortName,\n                                    color: (_d = app.color) !== null && _d !== void 0 ? _d : ext === null || ext === void 0 ? void 0 : ext.color,\n                                    enabled: true,\n                                    clickHandler() {\n                                        if (postmessageSyncCode) {\n                                            const message = {\n                                                target: ExtensionMessageTarget.EXTENSION,\n                                                payload: postmessageSyncCode,\n                                                targetId: app.id\n                                            };\n                                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                                            windowRef.postMessage(message, windowRef.location.origin);\n                                        }\n                                        statusUpdateHandler(WalletType.EXTENSION, this);\n                                    }\n                                };\n                            }),\n                            ...extensionList\n                                .filter((app) => defaultExtensions.some((extId) => extId === app.id))\n                                .map((app) => ({\n                                name: app.name,\n                                shortName: app.shortName,\n                                color: app.color,\n                                logo: app.logo,\n                                enabled: false,\n                                clickHandler: () => {\n                                    // Don't do anything\n                                }\n                            }))\n                        ]\n                    },\n                    {\n                        title: 'Desktop & Web Wallets',\n                        type: WalletType.DESKTOP,\n                        wallets: [\n                            ...desktopList.map((app) => ({\n                                name: app.name,\n                                shortName: app.shortName,\n                                color: app.color,\n                                logo: app.logo,\n                                enabled: true,\n                                clickHandler() {\n                                    const link = getTzip10Link(app.deepLink, pairingCode);\n                                    window.open(link, '_blank');\n                                    statusUpdateHandler(WalletType.DESKTOP, this);\n                                }\n                            })),\n                            ...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))\n                        ]\n                    }\n                ],\n                buttons: [],\n                qrData: qrLink\n            };\n        });\n    }\n    static getIOSPairingAlert(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            return {\n                walletLists: [\n                    {\n                        title: 'Mobile Wallets',\n                        type: WalletType.IOS,\n                        wallets: iOSList.map((app) => ({\n                            name: app.name,\n                            shortName: app.shortName,\n                            color: app.color,\n                            logo: app.logo,\n                            enabled: true,\n                            clickHandler() {\n                                var _a;\n                                const link = getTzip10Link((_a = app.deepLink) !== null && _a !== void 0 ? _a : app.universalLink, pairingCode);\n                                // iOS does not trigger deeplinks with `window.open(...)`. The only way is using a normal link. So we have to work around that.\n                                const a = document.createElement('a');\n                                a.setAttribute('href', link);\n                                a.dispatchEvent(new MouseEvent('click', { view: window, bubbles: true, cancelable: true }));\n                                statusUpdateHandler(WalletType.IOS, this);\n                            }\n                        }))\n                    },\n                    {\n                        title: 'Web Wallets',\n                        type: WalletType.WEB,\n                        wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n                    }\n                ],\n                buttons: [],\n                qrData: qrLink\n            };\n        });\n    }\n    static getAndroidPairingAlert(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const qrLink = getTzip10Link('tezos://', pairingCode);\n            return {\n                walletLists: [\n                    {\n                        title: 'Web Wallets',\n                        type: WalletType.WEB,\n                        wallets: [...(yield Pairing.getWebList(pairingCode, statusUpdateHandler, network))]\n                    }\n                ],\n                buttons: [\n                    {\n                        title: 'Mobile Wallets',\n                        text: 'Connect Wallet',\n                        clickHandler: () => {\n                            window.open(qrLink, '_blank');\n                            statusUpdateHandler(WalletType.ANDROID);\n                        }\n                    }\n                ],\n                qrData: qrLink\n            };\n        });\n    }\n    static getWebList(pairingCode, statusUpdateHandler, network) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return webList.map((app) => ({\n                name: app.name,\n                shortName: app.shortName,\n                color: app.color,\n                logo: app.logo,\n                enabled: true,\n                clickHandler() {\n                    var _a;\n                    const link = getTzip10Link((_a = app.links[network]) !== null && _a !== void 0 ? _a : app.links[NetworkType.MAINNET], pairingCode);\n                    window.open(link, '_blank');\n                    statusUpdateHandler(WalletType.WEB, this);\n                }\n            }));\n        });\n    }\n}\n//# sourceMappingURL=Pairing.js.map"]},"metadata":{},"sourceType":"module"}